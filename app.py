from flask import Flask, jsonify
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address
import database

app = Flask(__name__)

def get_limits():
    if app.config.get('TESTING'):
        return []
    return ["200 per day", "50 per hour"]

limiter = Limiter(
    get_remote_address,
    app=app,
    default_limits=get_limits()
)

@app.route('/v1/urlinfo/<path:resource_url>', methods=['GET'])
@limiter.limit("10 per minute", exempt_when=lambda: app.config.get('TESTING', False))
def url_info(resource_url):
    is_malicious = database.check_url(resource_url)
    print(f"URL: {resource_url}, is_malicious: {is_malicious}")  # Debugging output
    response = {
        'url': resource_url,
        'is_malicious': is_malicious
    }
    print(f"Response: {response}")  # Debugging output
    return jsonify(response)

if __name__ == '__main__':
    app.run(debug=True)
